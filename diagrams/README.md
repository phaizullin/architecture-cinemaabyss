# To-Be Архитектура КиноБездны

### 1. Доменное разделение
Система разделена на следующие домены:
- **Movies Domain** - управление фильмами, метаданными, рейтингами
- **User Domain** - управление пользователями, аутентификация, профили
- **Payment Domain** - обработка платежей, подписки, биллинг
- **Events Domain** - обработка событий между сервисами

### 2. Единая точка входа
**API Gateway** выступает как единая точка входа для всех клиентских запросов, обеспечивая:
- Унифицированный API для клиентов
- Аутентификацию и авторизацию
- Маршрутизацию запросов к соответствующим сервисам
- Постепенный переход от монолита к микросервисам

### 3. Постепенная миграция (Strangler Fig)
API Gateway реализует паттерн Strangler Fig, позволяющий:
- Контролировать процент трафика, направляемого к новым микросервисам
- Обеспечивать бесшовный переход без нарушения работы пользователей
- Откатываться к монолиту при необходимости

### 4. Событийно-ориентированная архитектура
- **Kafka** используется как message broker для асинхронной коммуникации
- События публикуются при изменениях в доменах
- Сервисы могут реагировать на события других доменов

## Компоненты архитектуры

### API Gateway (Proxy Service)
- **Технология**: Go/HTTP
- **Роль**: Единая точка входа, маршрутизация, аутентификация
- **Особенности**: Feature flags для постепенного перехода

### Монолитное приложение
- **Технология**: Go/HTTP
- **Роль**: Исходное приложение, постепенно заменяемое микросервисами
- **Содержит**: Все домены (пользователи, фильмы, платежи, подписки)

### Movies Service
- **Технология**: Go/HTTP
- **Роль**: Управление доменом фильмов
- **Функции**: Метаданные фильмов, рейтинги, жанры

### User Service
- **Технология**: Go/HTTP
- **Роль**: Управление доменом пользователей
- **Функции**: Регистрация, аутентификация, профили

### Payment Service
- **Технология**: Go/HTTP
- **Роль**: Управление доменом платежей
- **Функции**: Транзакции, подписки, интеграция с внешними платежными системами

### Events Service
- **Технология**: Go/HTTP
- **Роль**: Обработка событий между сервисами
- **Функции**: Публикация и потребление событий через Kafka

### Инфраструктурные компоненты
- **PostgreSQL**: Основная база данных
- **Apache Kafka**: Message broker для событий
- **Kafka UI**: Веб-интерфейс для мониторинга Kafka

## Контейнерная диаграмма
**Файл**: [containers.puml](containers.puml)

## Технологический стек

- **Языки программирования**: Go
- **База данных**: PostgreSQL
- **Message Broker**: Apache Kafka
- **Контейнеризация**: Docker
- **Оркестрация**: Kubernetes
- **CI/CD**: GitHub Actions
- **Мониторинг**: Kafka UI